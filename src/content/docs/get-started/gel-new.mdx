import Tab from '@mdx/Tab.astro';
import Tabs from '@mdx/Tabs.astro';
import Npm from "@mdx/Npm.astro";
import Npx from "@mdx/Npx.astro";
import Callout from '@mdx/Callout.astro';
import Steps from '@mdx/Steps.astro';
import AnchorCards from '@mdx/AnchorCards.astro';
import Breadcrumbs from '@mdx/Breadcrumbs.astro';
import Prerequisites from "@mdx/Prerequisites.astro";
import CodeTabs from "@mdx/CodeTabs.astro";
import FileStructure from '@mdx/get-started/FileStructure.mdx';
import InstallPackages from '@mdx/get-started/InstallPackages.mdx';
import ConnectGel from '@mdx/get-started/gel/ConnectGel.mdx'
import CreateTable from '@mdx/get-started/gel/CreateTable.mdx'
import RunFile from '@mdx/get-started/RunFile.mdx';
import QueryDatabase from '@mdx/get-started/gel/QueryGel.mdx';
import SetupEnv from '@mdx/get-started/SetupEnv.mdx';

<Breadcrumbs/>

# Get Started with Waddler and Gel

<Prerequisites>
  - **tsx** - package for running TypeScript files - [read here](https://tsx.is/)
  - **gel-js** - package for querying your Gel database - [read here](https://github.com/geldata/gel-js)
</Prerequisites>

Waddler has native support for Gel connections with the `gel` client.

{/* In the `src` directory, we have table definition in `index.ts`. In `drizzle` folder there are generated Gel to Drizzle schema */}

<FileStructure />

{/* TODO: do I need steps: Install and init **Gel** project, #### Step 2 - Define basic Gel schema, #### Step 3 - Push Gel schema to the database */}
{/* #### Step 1 - Install and init **Gel** project

<Callout>
Linux or macOS
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.edgedb.com | sh
```

For more options, check [gel docs](https://docs.geldata.com/reference/cli)
</Callout>

Once installed:
```bash
gel project init   
```

#### Step 2 - Define basic Gel schema

In `dbschema/default.esdl` file add a basic Gel schema

```esdl
module default {
    TYPE test {
        name: str;
        required email: str;
        age: int16;
    }
}
```

#### Step 3 - Push Gel schema to the database

Generate Gel migration file:
```bash
gel migration create
```

Apply Gel migrations to the database
```bash
gel migration apply
```

<Callout>
Now you should have this file structure

```plaintext
ðŸ“¦ <project root>
 â”œ ðŸ“‚ dbschema
 â”‚ â”œ ðŸ“‚ migrations
 â”‚ â”œ ðŸ“œ default.esdl
 â”‚ â”” ðŸ“œ scoping.esdl
 â”œ ðŸ“‚ src
 â”‚ â”” ðŸ“œ index.ts
 â”œ ðŸ“œ drizzle.config.ts
 â”œ ðŸ“œ edgedb.toml
 â”œ ðŸ“œ package.json
 â”” ðŸ“œ tsconfig.json
```
</Callout> */}

#### Step 1 - Install **gel** package
<Npm>
  waddler gel
  -D tsx
</Npm>

#### Step 2 - Setup connection variables

<SetupEnv env_variable='DATABASE_URL' />

#### Step 3 - Connect Waddler to the database

<ConnectGel />

#### Step 4 - Create a table

<CreateTable />

#### Step 5 - Query the database

<QueryDatabase/>

#### Step 6 - Run index.ts file

<RunFile/>