import Tab from '@mdx/Tab.astro';
import Tabs from '@mdx/Tabs.astro';
import Npm from "@mdx/Npm.astro";
import Callout from '@mdx/Callout.astro';
import Steps from '@mdx/Steps.astro';
import AnchorCards from '@mdx/AnchorCards.astro';
import Prerequisites from "@mdx/Prerequisites.astro";
import CodeTabs from '@mdx/CodeTabs.astro';
import CodeTab from '@mdx/CodeTab.astro';
import Section from "@mdx/Section.astro";
import LinksList from "@mdx/LinksList.astro"
import Flex from "@mdx/Flex.astro"

# Database connection with Waddler
Waddler runs SQL queries on your database via **database drivers**.
<CodeTabs items={["index.ts"]}>

<CodeTab>
```ts
import { waddler } from "waddler/node-postgres"

const sql = waddler(process.env.DATABASE_URL);
const usersCount = await sql`select count(*) from ${sql.identifier('users')};`;
```
```  
          ┌─────────────────────────────────────────────────────────┐
          │  sql`select count(*) from ${sql.identifier('users')};`  │ <--- waddler query
          └─────────────────────────────────────────────────────────┘     
                               │               ʌ
select count(*) from "users"; -│               │
                               │               │- [{ count: 0 }]
                               v               │
                            ┌─────────────────────┐
                            │    node-postgres    │ <--- database driver
                            └─────────────────────┘
                               │               ʌ
01101000 01100101 01111001    -│               │
                               │               │- 01110011 01110101 01110000
                               v               │
                            ┌────────────────────┐
                            │      Database      │ 
                            └────────────────────┘
```
</CodeTab>
</CodeTabs>

Under the hood Waddler will create a **node-postgres** driver instance
<Section>
```ts
// above is equivalent to
import { waddler } from "waddler/node-postgres";
import { Pool } from "pg";

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});
const sql = waddler({ client: pool });
```
</Section>

Waddler is by design natively compatible with every **edge** or **serverless** runtime, whenever you'd need access to a serverless database - we've got you covered

<CodeTabs items={["Neon HTTP", "Neon with websockets", "Vercel Postgres", "PlanetScale HTTP", "Cloudflare d1"]}>
```ts
import { waddler } from "waddler/neon-http";

const sql = waddler(process.env.DATABASE_URL);
```
```ts
import { waddler } from "waddler/neon-serverless";

const sql = waddler(process.env.DATABASE_URL);
```
```ts
import { waddler } from "waddler/vercel-postgres";

const sql = waddler();
```
```ts
import { waddler } from "waddler/planetscale";

const sql = waddler(process.env.DATABASE_URL);
```
```ts
import { waddler } from "waddler/d1";

const sql = waddler({ connection: env.DB });
```
</CodeTabs>

And yes, we do support runtime specific drivers like [Bun SQLite](/docs/connect-bun-sqlite) or [Expo SQLite](/docs/connect-expo-sqlite):
<Section>
```ts
import { waddler } from "waddler/bun-sqlite"

const sql = waddler(); // <--- will create an in-memory db
const sql = waddler("./sqlite.db");
```
```ts
import { waddler } from "waddler/expo-sqlite";
import { openDatabaseSync } from "expo-sqlite";

const expo = openDatabaseSync("db.db");
const sql = waddler({ client: expo });
```
</Section>

#### Database connection URL
Just in case if you're not familiar with database connection URL concept
```
postgresql://alex:AbC123dEf@ep-cool-darkness-123456.us-east-2.aws.neon.tech/dbname
             └──┘ └───────┘ └─────────────────────────────────────────────┘ └────┘
              ʌ    ʌ          ʌ                                              ʌ
        role -│    │          │- hostname                                    │- database
                   │
                   │- password

```
#### Next steps
Feel free to check out per-driver documentations  

<rem/>
<Flex>
  <LinksList 
    title='PostgreSQL drivers'
    links={[
        ["PostgreSQL", "/docs/connect-postgresql"], 
        ["Neon", "/docs/connect-neon"], 
        ["Vercel Postgres", "/docs/connect-vercel-postgres"],
        ["Supabase", "/docs/connect-supabase"],
        ["Xata", "/docs/connect-xata"],
        ["PGLite", "/docs/connect-pglite"],
      ]}
  />
  <LinksList 
    title='Gel drivers'
    links={[
        ["Gel", "/docs/connect-gel"],
      ]}
  />
  <LinksList 
    title='MySQL drivers'
    links={[
        ["MySQL", "/docs/connect-mysql"], 
        ["PlanetsScale", "/docs/connect-planetscale"], 
        ["TiDB", "/docs/connect-tidb"],
      ]}
  />
  <LinksList 
  title='SQLite drivers'
  links={[
      ["SQLite", "/docs/connect-sqlite"], 
      ["Turso", "/docs/connect-turso"], 
      ["Cloudflare D1", "/docs/connect-cloudflare-d1"],
      ["Bun SQLite", "/docs/connect-bun-sqlite"],
    ]}
  />
  <LinksList 
  title='Native SQLite'
  links={[
      ["Expo SQLite", "/docs/get-started/expo-new"], 
      ["OP SQLite", "/docs/connect-op-sqlite"], 
    ]}
  />
</Flex>
{/* TODO: @AndriiSherman ["AWS Data API", "/docs/get-started/aws-data-api"],  */}
